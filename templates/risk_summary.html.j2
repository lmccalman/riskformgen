<article>
  {# ── Header ── #}
  <header>
    <h3>{{ risk.name }}</h3>
    <p><small>{{ risk.description }}</small></p>
  </header>

  {# ── Modelled risk: likelihood × consequence → level ── #}
  <div class="risk-grid">
    {# Likelihood #}
    <div>
      <span class="dim-label">Likelihood</span>
      <span
        class="badge badge-blue"
        x-text="{{ risk.id }}.likelihood.replace(/_/g, ' ')"
      ></span>
    </div>

    {# Consequence #}
    <div>
      <span class="dim-label">Consequence</span>
      <span
        class="badge badge-purple"
        x-text="{{ risk.id }}.consequence.replace(/_/g, ' ')"
      ></span>
    </div>

    {# Modelled risk level (colour-coded) #}
    <div>
      <span class="dim-label">Modelled Risk</span>
      <span
        class="badge"
        :class="{
          'badge-gray': {{ risk.id }}.level === 'not_applicable',
          'badge-green': {{ risk.id }}.level === 'low',
          'badge-amber': {{ risk.id }}.level === 'medium',
          'badge-red': {{ risk.id }}.level === 'high',
        }"
        x-text="{{ risk.id }}.level.replace(/_/g, ' ')"
      ></span>
    </div>
  </div>

  {# ── Controls ── #}
  {% if risk.controls %}
  <div>
    <span class="dim-label">Controls</span>
    <div class="stack-sm">
      {% for ctrl in risk.controls %}
      <div class="control-row">
        <span
          class="control-icon"
          :class="ctrl_{{ ctrl.id }}
            ? 'control-icon-active'
            : 'control-icon-inactive'"
          x-text="ctrl_{{ ctrl.id }} ? '✓' : '✗'"
        ></span>
        <span
          :class="ctrl_{{ ctrl.id }} ? '' : 'answer-missing'"
          >{{ ctrl.name }}</span>
        <span class="control-effect">
          {% if ctrl.reduces_likelihood and ctrl.reduces_consequence %}↓ Likelihood &amp; Consequence
          {% elif ctrl.reduces_likelihood %}↓ Likelihood
          {% else %}↓ Consequence
          {% endif %}
        </span>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  {# ── Assessed risk (user-selected) ── #}
  <div>
    <span class="dim-label">Assessed Risk</span>
    <div class="assessed-row">
      <select x-model="assessed_risks.{{ risk.id }}">
        <option value="">— Select —</option>
        {% for level in risk_levels %}
        <option value="{{ level }}">{{ level | replace("_", " ") | title }}</option>
        {% endfor %}
      </select>
      <span
        x-show="assessed_risks.{{ risk.id }}"
        x-cloak
        class="badge"
        :class="{
          'badge-gray': assessed_risks.{{ risk.id }} === 'not_applicable',
          'badge-green': assessed_risks.{{ risk.id }} === 'low',
          'badge-amber': assessed_risks.{{ risk.id }} === 'medium',
          'badge-red': assessed_risks.{{ risk.id }} === 'high',
        }"
        x-text="assessed_risks.{{ risk.id }}.replace(/_/g, ' ')"
      ></span>
    </div>
  </div>

  {# ── Justification ── #}
  <div>
    <label class="dim-label" for="justification_{{ risk.id }}">Justification</label>
    <textarea
      id="justification_{{ risk.id }}"
      x-model="justifications.{{ risk.id }}"
      rows="2"
      placeholder="Provide reasoning for the assessed risk level…"
    ></textarea>
  </div>

  {# ── Linked answers ── #}
  {% if risk.questions %}
  <hr />
  <ul class="stack-sm">
    {% for q in risk.questions %}
    <li class="linked-answer">
      <span>{{ q.text }}</span>
      <span
        :class="_formatAnswer(answers['{{ q.id }}']) === 'Not answered'
          ? 'answer-missing'
          : ''"
        x-text="_formatAnswer(answers['{{ q.id }}'])"
      ></span>
    </li>
    {% endfor %}
  </ul>
  {% endif %}
</article>
